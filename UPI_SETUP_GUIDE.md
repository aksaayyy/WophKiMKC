# ğŸ“± UPI Payment Integration Guide

## ğŸš€ **Quick Setup (5 minutes)**

### **1. Create Razorpay Account**
1. Go to https://razorpay.com
2. Sign up with your business details
3. Complete KYC verification (required for live payments)
4. Get your API keys from Dashboard â†’ Settings â†’ API Keys

### **2. Configure Environment Variables**
Add these to your `.env.local` and Vercel environment variables:

```bash
# Razorpay Configuration
NEXT_PUBLIC_RAZORPAY_KEY_ID=rzp_test_your_key_id_here
RAZORPAY_KEY_SECRET=your_razorpay_key_secret_here
```

### **3. Install Dependencies**
```bash
npm install razorpay
```

### **4. Run Database Migration**
Execute the updated migration in Supabase SQL Editor:
```sql
-- The migration includes payment_orders table and UPI support
-- File: supabase/migrations/003_subscriptions.sql
```

### **5. Test UPI Integration**
```bash
npm run dev
# Navigate to /pricing and test UPI payment flow
```

## ğŸ’° **UPI Pricing (INR)**

| Plan | Monthly | Annual | Savings |
|------|---------|--------|---------|
| **Starter** | â‚¹899 | â‚¹7,999 | â‚¹1,789 (18%) |
| **Pro** | â‚¹2,399 | â‚¹19,999 | â‚¹8,789 (31%) |
| **Enterprise** | â‚¹6,499 | â‚¹54,999 | â‚¹22,489 (34%) |

## ğŸ”§ **Features Included**

### âœ… **UPI Payment Methods**
- **UPI Apps**: PhonePe, Google Pay, Paytm, BHIM
- **QR Code**: Scan and pay from any UPI app
- **UPI ID**: Direct payment using UPI ID
- **Cards**: All Indian debit/credit cards
- **Net Banking**: All major Indian banks
- **Wallets**: Paytm, Mobikwik, Freecharge, etc.

### âœ… **Payment Flow**
1. User selects plan and billing cycle
2. Razorpay order created on server
3. Payment popup opens with UPI options
4. User completes payment via preferred method
5. Payment verified and subscription activated
6. User redirected to dashboard

### âœ… **Security Features**
- Payment signature verification
- Secure webhook handling
- PCI DSS compliant
- Bank-grade encryption
- Fraud detection

## ğŸ›  **Technical Implementation**

### **API Endpoints Created**
- `POST /api/v1/payments/upi/create-order` - Create Razorpay order
- `POST /api/v1/payments/upi/verify` - Verify payment and activate subscription

### **Components Created**
- `UPIPayment.tsx` - UPI payment interface
- `PaymentOptions.tsx` - Combined payment method selector
- `razorpay.ts` - Razorpay configuration and utilities

### **Database Schema**
```sql
-- Enhanced user_subscriptions table with UPI support
-- New payment_orders table for order tracking
-- Proper indexing and RLS policies
```

## ğŸŒ **Why UPI is Perfect for Indian Users**

### **Advantages over International Gateways**
1. **Lower Fees**: 0-2% vs 3-4% for international cards
2. **Higher Success Rate**: 95%+ vs 70-80% for international payments
3. **Instant Settlement**: Real-time vs 2-3 days
4. **No Currency Conversion**: Direct INR pricing
5. **Familiar Interface**: Users already use UPI daily
6. **Mobile-First**: Optimized for smartphone usage

### **Market Penetration**
- 350+ million UPI users in India
- 8+ billion transactions per month
- Supported by all major banks
- Government-backed infrastructure

## ğŸš€ **Production Deployment**

### **1. Razorpay Live Setup**
1. Complete business verification
2. Switch to live API keys
3. Configure webhook URL: `https://yourdomain.com/api/v1/payments/upi/webhook`
4. Enable required payment methods

### **2. Environment Variables (Production)**
```bash
NEXT_PUBLIC_RAZORPAY_KEY_ID=rzp_live_your_live_key
RAZORPAY_KEY_SECRET=your_live_secret_key
```

### **3. Webhook Configuration**
- URL: `https://yourdomain.com/api/v1/payments/upi/webhook`
- Events: `payment.captured`, `payment.failed`, `order.paid`
- Secret: Auto-generated by Razorpay

## ğŸ“Š **Monitoring & Analytics**

### **Razorpay Dashboard**
- Real-time payment tracking
- Success/failure rates
- Settlement reports
- Refund management
- Customer analytics

### **Custom Metrics**
- Conversion rates by payment method
- Popular UPI apps
- Geographic distribution
- Revenue analytics

## ğŸ”„ **User Experience Flow**

### **Desktop Flow**
1. User clicks "Pay with UPI"
2. QR code displayed
3. User scans with UPI app
4. Completes payment on phone
5. Automatic verification and activation

### **Mobile Flow**
1. User clicks "Pay with UPI"
2. UPI app opens directly
3. User authorizes payment
4. Returns to website
5. Automatic verification and activation

## ğŸ’¡ **Best Practices**

### **Pricing Strategy**
- Price in round numbers (â‚¹899, not â‚¹900)
- Offer significant annual discounts (25-35%)
- Consider festival season pricing
- A/B test different price points

### **UX Optimization**
- Show popular payment methods first
- Display estimated processing time
- Provide payment status updates
- Offer customer support chat

### **Conversion Optimization**
- Highlight savings on annual plans
- Show "Most Popular" badges
- Use social proof and testimonials
- Minimize form fields

## ğŸ¯ **Next Steps**

1. **Test thoroughly** with Razorpay test credentials
2. **Complete KYC** for live payments
3. **Set up monitoring** and alerts
4. **Launch with UPI** as primary payment method
5. **Monitor metrics** and optimize conversion

## ğŸ“ **Support**

### **Razorpay Support**
- Documentation: https://razorpay.com/docs/
- Support: support@razorpay.com
- Phone: 1800-120-020-020

### **Integration Issues**
- Check API credentials
- Verify webhook configuration
- Test with different UPI apps
- Monitor server logs

Your UPI payment integration is now ready! ğŸ‰

**Key Benefits:**
- âœ… Easy 5-minute setup
- âœ… 95%+ success rate
- âœ… Lower transaction fees
- âœ… Instant settlements
- âœ… Mobile-optimized experience
- âœ… Supports all major UPI apps