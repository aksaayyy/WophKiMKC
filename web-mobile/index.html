<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f0f0f">
    <title>HookClip Mobile</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: #fff;
            min-height: 100vh;
            padding-bottom: 80px;
        }
        
        .header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px;
            border-bottom: 1px solid #333;
        }
        
        .header-icon {
            width: 32px;
            height: 32px;
            background: #ef4444;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-icon svg {
            width: 20px;
            height: 20px;
            fill: white;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .container {
            padding: 16px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            color: #fff;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .input-wrapper {
            display: flex;
            align-items: center;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 12px;
        }
        
        .input-wrapper input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 16px;
            outline: none;
        }
        
        .input-wrapper input::placeholder {
            color: #666;
        }
        
        .options {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .option-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        
        .option-row:last-child {
            border-bottom: none;
        }
        
        .option-label {
            font-weight: 500;
        }
        
        .option-sublabel {
            color: #666;
            font-size: 12px;
            margin-top: 2px;
        }
        
        .counter {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .counter button {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: #333;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }
        
        .counter button:disabled {
            opacity: 0.3;
        }
        
        .counter span {
            font-size: 18px;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }
        
        .platforms {
            display: flex;
            gap: 8px;
        }
        
        .platform-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #666;
            font-size: 12px;
            cursor: pointer;
            text-align: center;
        }
        
        .platform-btn.active {
            border-color: #ef4444;
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        
        .submit-btn {
            width: 100%;
            padding: 16px;
            background: #ef4444;
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .submit-btn:disabled {
            background: #333;
            cursor: not-allowed;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .progress-header {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .progress-thumbnail {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .progress-info h3 {
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .progress-info p {
            color: #666;
            font-size: 12px;
        }
        
        .progress-bar {
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #ef4444;
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        .progress-fill.complete {
            background: #22c55e;
        }
        
        .progress-status {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .clips-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .clip-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .clip-card video {
            width: 100%;
            height: 200px;
            background: #000;
        }
        
        .clip-info {
            padding: 12px;
        }
        
        .clip-info p {
            font-size: 12px;
            color: #666;
        }
        
        .download-btn {
            width: 100%;
            padding: 8px;
            background: #333;
            border: none;
            border-radius: 6px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 24px;
            background: transparent;
            border: none;
            color: #666;
            font-size: 12px;
            cursor: pointer;
        }
        
        .nav-btn.active {
            color: #ef4444;
        }
        
        .nav-btn svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            color: #ff4444;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-icon">
            <svg viewBox="0 0 24 24"><path d="M9.525 18.025q-.5.325-1.012.038T8 17.175V6.825q0-.65.513-.938t1.012.038l8.15 5.175q.45.3.45.9t-.45.9l-8.15 5.175Z"/></svg>
        </div>
        <h1>HookClip</h1>
    </div>

    <!-- Home Tab -->
    <div id="home-tab" class="tab-content active">
        <div class="container">
            <div id="error-container"></div>
            
            <div class="input-group">
                <label>YouTube URL</label>
                <div class="input-wrapper">
                    <input type="url" id="url-input" placeholder="https://youtube.com/watch?v=...">
                </div>
            </div>

            <!-- Progress Card -->
            <div id="progress-card" class="progress-card" style="display: none;">
                <div class="progress-header">
                    <img id="progress-thumb" class="progress-thumbnail" src="" alt="">
                    <div class="progress-info">
                        <h3 id="progress-title">Loading...</h3>
                        <p id="progress-meta"></p>
                    </div>
                </div>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-status">
                    <span id="progress-icon">‚è≥</span>
                    <span id="progress-text">Queued</span>
                    <span id="progress-percent" style="margin-left: auto; color: #666;">0%</span>
                </div>
            </div>

            <!-- Options -->
            <div class="options">
                <label style="display: block; margin-bottom: 12px; font-weight: 600;">Platform</label>
                <div class="platforms">
                    <button class="platform-btn active" data-platform="youtube">YouTube</button>
                    <button class="platform-btn" data-platform="tiktok">TikTok</button>
                    <button class="platform-btn" data-platform="instagram">Instagram</button>
                </div>

                <div class="option-row">
                    <div>
                        <div class="option-label">Number of Clips</div>
                    </div>
                    <div class="counter">
                        <button id="clip-minus">-</button>
                        <span id="clip-count">3</span>
                        <button id="clip-plus">+</button>
                    </div>
                </div>

                <div class="option-row">
                    <div>
                        <div class="option-label">Clip Duration</div>
                    </div>
                    <div class="counter">
                        <button id="dur-minus">-</button>
                        <span id="clip-duration">40s</span>
                        <button id="dur-plus">+</button>
                    </div>
                </div>

                <div class="option-row">
                    <div>
                        <div class="option-label">Detection Mode</div>
                        <div class="option-sublabel">Smart (AI) - Best for podcasts</div>
                    </div>
                </div>
            </div>

            <button id="submit-btn" class="submit-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M9.525 18.025q-.5.325-1.012.038T8 17.175V6.825q0-.65.513-.938t1.012.038l8.15 5.175q.45.3.45.9t-.45.9l-8.15 5.175Z"/></svg>
                Generate Clips
            </button>
        </div>
    </div>

    <!-- Clips Tab -->
    <div id="clips-tab" class="tab-content">
        <div class="container">
            <div id="clips-container" class="clips-grid"></div>
            <p id="no-clips" style="text-align: center; color: #666; padding: 40px;">No clips yet. Create a job from the Home tab.</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-bar">
        <button class="nav-btn active" data-tab="home">
            <svg viewBox="0 0 24 24"><path d="M12 3L4 9v12h16V9l-8-6zm0 2.5L18 10v9H6v-9l6-4.5z"/></svg>
            Home
        </button>
        <button class="nav-btn" data-tab="clips">
            <svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z"/></svg>
            Clips
        </button>
    </nav>

    <script>
        // API Configuration
        // Use current hostname for API (works with port forwarding)
        const API_BASE = 'http://localhost:3001/api';
        
        // State
        let currentJob = null;
        let pollInterval = null;
        let options = {
            clipCount: 3,
            clipDuration: 40,
            platform: 'youtube',
            detectionMode: 'smart',
            enableSubtitles: false,
            subtitleStyle: 'highlight',
            enableFaceTracking: false
        };

        // DOM Elements
        const urlInput = document.getElementById('url-input');
        const submitBtn = document.getElementById('submit-btn');
        const clipCountEl = document.getElementById('clip-count');
        const clipDurationEl = document.getElementById('clip-duration');
        const progressCard = document.getElementById('progress-card');
        const errorContainer = document.getElementById('error-container');

        // Platform selection
        document.querySelectorAll('.platform-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                options.platform = btn.dataset.platform;
            });
        });

        // Counter controls
        document.getElementById('clip-minus').addEventListener('click', () => {
            if (options.clipCount > 1) {
                options.clipCount--;
                clipCountEl.textContent = options.clipCount;
            }
        });

        document.getElementById('clip-plus').addEventListener('click', () => {
            if (options.clipCount < 10) {
                options.clipCount++;
                clipCountEl.textContent = options.clipCount;
            }
        });

        document.getElementById('dur-minus').addEventListener('click', () => {
            if (options.clipDuration > 15) {
                options.clipDuration -= 5;
                clipDurationEl.textContent = options.clipDuration + 's';
            }
        });

        document.getElementById('dur-plus').addEventListener('click', () => {
            if (options.clipDuration < 90) {
                options.clipDuration += 5;
                clipDurationEl.textContent = options.clipDuration + 's';
            }
        });

        // Tab navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(tab + '-tab').classList.add('active');
                
                if (tab === 'clips') {
                    loadClips();
                }
            });
        });

        // Submit job
        submitBtn.addEventListener('click', async () => {
            const url = urlInput.value.trim();
            if (!url) {
                showError('Please enter a YouTube URL');
                return;
            }

            errorContainer.innerHTML = '';
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> Creating...';

            try {
                const response = await fetch(`${API_BASE}/jobs`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, ...options })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error || 'Failed to create job');
                }

                const data = await response.json();
                currentJob = data;
                showProgress(data);
                startPolling(data.jobId);
            } catch (error) {
                showError(error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M9.525 18.025q-.5.325-1.012.038T8 17.175V6.825q0-.65.513-.938t1.012.038l8.15 5.175q.45.3.45.9t-.45.9l-8.15 5.175Z"/></svg>
                    Generate Clips
                `;
            }
        });

        function showError(message) {
            errorContainer.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function showProgress(job) {
            progressCard.style.display = 'block';
            document.getElementById('progress-thumb').src = job.thumbnail;
            document.getElementById('progress-title').textContent = job.videoTitle;
            document.getElementById('progress-meta').textContent = 
                `${Math.floor(job.videoDuration / 60)}m ${job.videoDuration % 60}s ‚Ä¢ ${job.clipCount} clips`;
            updateProgress(0, 'queued');
        }

        function updateProgress(percent, status) {
            const fill = document.getElementById('progress-fill');
            const text = document.getElementById('progress-text');
            const percentEl = document.getElementById('progress-percent');
            const icon = document.getElementById('progress-icon');

            fill.style.width = percent + '%';
            percentEl.textContent = Math.round(percent) + '%';

            const statusMap = {
                'queued': { icon: '‚è≥', text: 'Queued' },
                'downloading': { icon: '‚¨áÔ∏è', text: 'Downloading...' },
                'analyzing': { icon: 'üîç', text: 'Analyzing...' },
                'clipping': { icon: '‚úÇÔ∏è', text: 'Generating clips...' },
                'completed': { icon: '‚úÖ', text: 'Complete!' },
                'failed': { icon: '‚ùå', text: 'Failed' }
            };

            const s = statusMap[status] || { icon: '‚è≥', text: status };
            icon.textContent = s.icon;
            text.textContent = s.text;

            if (status === 'completed') {
                fill.classList.add('complete');
                submitBtn.disabled = false;
                submitBtn.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M9.525 18.025q-.5.325-1.012.038T8 17.175V6.825q0-.65.513-.938t1.012.038l8.15 5.175q.45.3.45.9t-.45.9l-8.15 5.175Z"/></svg>
                    Generate Clips
                `;
            }
        }

        function startPolling(jobId) {
            if (pollInterval) clearInterval(pollInterval);
            
            pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE}/jobs/${jobId}`);
                    const data = await response.json();
                    
                    updateProgress(data.progress, data.status);
                    currentJob = { ...currentJob, ...data };

                    if (data.status === 'completed' || data.status === 'failed') {
                        clearInterval(pollInterval);
                        if (data.status === 'completed') {
                            loadClips();
                        }
                    }
                } catch (error) {
                    console.error('Poll error:', error);
                }
            }, 2000);
        }

        async function loadClips() {
            if (!currentJob || currentJob.status !== 'completed') {
                document.getElementById('clips-container').innerHTML = '';
                document.getElementById('no-clips').style.display = 'block';
                return;
            }

            document.getElementById('no-clips').style.display = 'none';
            const container = document.getElementById('clips-container');
            
            container.innerHTML = currentJob.clips.map((clip, i) => `
                <div class="clip-card">
                    <video controls poster="${currentJob.thumbnail}">
                        <source src="${API_BASE}/clips/${currentJob.id}/${clip.filename}" type="video/mp4">
                    </video>
                    <div class="clip-info">
                        <p>Clip ${i + 1} ‚Ä¢ ${Math.floor(clip.startTime / 60)}:${String(clip.startTime % 60).padStart(2, '0')}</p>
                        <button class="download-btn" onclick="downloadClip('${clip.filename}')">Download</button>
                    </div>
                </div>
            `).join('');
        }

        function downloadClip(filename) {
            if (!currentJob) return;
            const url = `${API_BASE}/clips/${currentJob.id}/${filename}`;
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }
    </script>
</body>
</html>
